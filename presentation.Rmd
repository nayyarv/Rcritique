---
title: "inteRnals"
author: "Varun Nayyar"
date: "27/04/2019"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
requireNamespace("tibble")
library(pryr)
```

## My Programming History

- 2010: Started programming. Began with C, but ran away from computers because it was hard.
- 2011: Started programming with R in 2011, realised it wasn't so bad. R became my daily driver and I used R instead of Matlab at university 
  - before the tidyverse
  - used knitr before R markdown (shell script escapes on pdflatex)
  - mostly tiny uni datasets, never ran into problems
  - I am so glad it's better today.
  
  
## My Programming History
- 2013: Started programming in Python while at Cochlear. Fell in love with programming
  - Started to run into performance issues with R. Sessions kept crashing and datasets started getting bigger.
  - Became a Bayesian - now I needed efficiency and started to program a lot more (BUGS anybody)
  - Started to switch to python a lot more.
- 2014: Returned to comp sci becoming more confident with C, Java. Picked up some Haskell and CUDA too!
- 2015-2018: Working for HFT, mostly using Python and C++
- 2018: Used R for census and survey analysis (Parliament)
- 2019: Using Julia for Speech Recognition and Deep Learning.

## Informal Survey

- How many languages can you program in besides R?
- Have you used S3 or S4 methods?
- Do you consider yourself a user or a developer?

## What to Expect

 - Hadley's Advanced R without Hadley
 - Some Comp Sci theory and terms
 - Some cross language comparisons
 - Mini metaprogramming
 - Harsh comments directed at R's core team.

## TOC

1. Language
2. History of R
3. R as a Language
4. Experiments in R (merge with above)
    - Lazy Eval and Quosures
    - Environments and Closures
    - Infix operators

# Programming Languages

## Programming Languages

  - **What is a programming language?**
    - R as a programming Language
    - Python as  Programming Language
  - **Functional vs imperative**
    - Functional Languages
    - R as a Functional Language
    - Imperative Languages
    - R as imperative 

## What is a Programming Language?

- Language != Implementation
- A langauge is a defined in abstract way, usually syntax specifications and behaviour
- Languages can grow and evolve, by adding new syntax or new features.
  - Python added the `@` syntax for matrix multiplication
  - Java added the concept of `lambda`s, the ability to pass functions as arguments
- Each language has an implementation. Usually the people who write the language spec, provide a reference implementation


## R as a language

- R is not formally defined like most programming languages.
- R is specified by the implementation - GNU R
  - It is simulataneously loosely defined
  - And impossible to write a new version (due to implementation specific problems)
- Other dialects
  - pqR - written by Radford Neal to be more performant, it branches of R 2.15
  - Revolution R - powering Azure's R, it's a closed source implementation with supposedly better performance,

## Python as a language

- Spec produced by Python Foundation.
- Also produce CPython, a reference implemention implemented in C
  - Has very good interoperability with C, but this is not part of the Python spec, a feature of CPython
- Other dialects
  - PyPy (Just In Time compiled) - can be very quick, but doesn't play nicely with C extensions (say numpy)
  - Stackless Python - used by EVE online, allows for massive concurrency
  - Jython - compiles to the JVM
- You also have Cython which is an extension of Python with typing for speed, and RPython which is a limited subset of the langauge.

## Functional Languages

- Basically mathematics turned into code (Lambda Calculus)
- Composed purely of functions, no state
  - global state causes a majority of errors
- Functions are the same as variables
- No memory management
- Immutable is commonly
- Looping is not allowed, only recursion is possible.
- `apply`/`map` and ideas such as list comprehensions are functional concepts

```haskell
# haskell
factorial 0 = 1
factorial n = n * factorial (n-1)
```

## R as a functional language

- You can assign functions to other names
```{r}
test = sum
test(1:10)
```
- you can take them into another equation (and define without naming)
```{r}
sapply(1:10, function(x) x^2)
```
- Other goodies (we'll cover)

## Imperative Programming

- Imperative programming is a direct contrast to functional programming. In this case, variables change state
- Object Oriented (OO) is simply an extension of imperative programming to be more modular and maintainable. 
- Fine grained control of computer resources (memory and threads)
- Highly performant, but easy to introduce errors.
- Most functional languages are based on imperative languages

```c
int vec[10] = {1,2,3,4,5,6,7,8,9,10}; 
int sum = 0;
for (int i=0; i < 10, i ++){
  sum += vec[i]
}
```

## R as an imperative language

```{r}
total = 0
vec = 1:10
for (i in vec){
  total =  total + i
}
total
```

```{r}
attr(total, "N") = 10
class(total) = "Sum"
tibble::as_tibble(attributes(total))
```

## R is a mixed Imperative/Functional Language

- This has become the dominant programming paradigm, especially in Data Analysis.
- Python, Scala, Julia and javascript are all mixed functional/imperative to varying degrees
- Java and C++ have also taken on a lot of functional features
- Most popular pure functional languages are primarily academic curiosity

# insert line graph of varying functional/imperativeness

haskell on functional, Java on imperative
Python closer to imperative
R middle
Julia closer to functional

# History of R

## History of S

- Developed in the 70s at Bell labs by John Chambers
- 1988 had the 3.0 release - it's seminal release
  - Rewritten in C
  - Object Oriented (S3) methods introduced
  - A programming language, not just some fortran bindings
- 1998 had the 4.0 release. Mostly better OO (S4)
- S is purely imperative

```r
factorial <- function(n)
  if (n<=0) 1 else n * factorial(n - 1)
```

## History of Scheme

- Scheme is a dialect of Lisp (List Processor) one of the first functional programming languages.
- Lisp was introduced as a purely mathematical langauge, and Scheme filled in the missing parts to run on a computer.
- Functional languages have become very popular in Software Engineering today for being expressive and Lisp has been incredibly influential despite never finding much success itself.
- Scheme is a mix of functional and imperative style
- R, Julia and Python all trace back to Lisp, R via Scheme, Python via Common Lisp, another Lisp dialect

```scheme
(define factorial (lambda (n)
  (if (<= n 0)) 1 (* n factorial(n-1))
))
```

## History of R

- Combination of S syntax on a Scheme interpreter
- Mixed imperative/functional style. Is a functional language at it's core.
- Released for free (almost didn't) in a time of open source infancy, when competitors such SAS, SPSS, S+ were paid products
- The language is incredibly flexible, which allows for rich user usage.
- CRAN was perhaps the biggest innovation.
- **Strong focus on User Experience, than developer convenience**

# The R language

## The R language

  - Basic Types
  - R and memory (pass by value and GC)
  - Lexical Scoping and closures
  - Lazy Evaluation
  - S3 and S4 methods
  
## Types
 - Might Remove
 
 
## R and Memory

Is R:

- pass by value (copies data for a function)
- pass by reference (passes the underlying data)

## Copy on Modify

- R implements these mechanics 


